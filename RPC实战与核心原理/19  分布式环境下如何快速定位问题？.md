
# 19 | 分布式环境下如何快速定位问题？

### 如何做到快速定位问题？

**方法 1：借助合理封装的异常信息**

![image-20220116100201070](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220116100201070.png)

一款优秀的 RPC 框架要对异常进行详细地封装，还要对各类异常进行分类，每类异常都要有明确的异常标识码，并整理成一份简明的文档。使用方可以快速地通过异常标识码在文档中查阅，从而快速定位问题，找到原因

**方法 2：借助分布式链路跟踪**

分布式链路跟踪就是将一次分布式请求还原为一个完整的调用链路，我们可以在整个调用链路中跟踪到这一次分布式请求的每一个环节的调用情况

**如何整合分布式链路跟踪？**

分布式链路跟踪有 Trace 与 Span 的概念，什么意思呢，我逐一解释。

Trace 就是代表整个链路，每次分布式都会产生一个 Trace，每个 Trace 都有它的唯一标识即 TraceId，在分布式链路跟踪系统中，就是通过 TraceId 来区分每个 Trace 的。

Span 就是代表了整个链路中的一段链路，也就是说 Trace 是由多个 Span 组成的。在一个 Trace 下，每个 Span 也都有它的唯一标识 SpanId，而 Span 是存在父子关系的。

![image-20220116100409447](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220116100409447.png)

RPC 调用端在访问服务端时，在发送请求消息前会触发分布式跟踪埋点，在接收到服务端响应时，也会触发分布式跟踪埋点，并且在服务端也会有类似的埋点。这些埋点最终可以记录一个完整的 Span，而这个链路的源头会记录一个完整的 Trace，最终 Trace 信息会被上报给分布式链路跟踪系统。

### 引申

**APM(Application Performance Management)** :应用性能监控,来自google的Dapper.

PinPonit与zipkin的比较

![preview](https://pic1.zhimg.com/v2-b7c81287ef5b8bd272aaac89b9e426f0_r.jpg)



Spring Cloud Slueth 聚焦在链路追踪和分析，将信息发送到Zipkin，利用 Zipkin的存储来存储信息,zipkin已链路分析为主.PinPoint已服务拓扑和接口调用分析为主.




参考:

[SkyWalking 分布式追踪系统](https://www.jianshu.com/p/2fd56627a3cf)

[解锁APM(Pinpoint）入门与实战](https://zhuanlan.zhihu.com/p/43599131)

[《google的Dapper 中文翻译》](http://bigbully.github.io/Dapper-translation/)

[pinpoint 技术细节](http://pinpoint-apm.github.io/pinpoint/1.7.3/techdetail.html#conclusions)