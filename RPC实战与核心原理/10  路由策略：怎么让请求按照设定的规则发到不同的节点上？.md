# 10 | 路由策略：怎么让请求按照设定的规则发到不同的节点上？

### 为什么选择路由策略？

减少上线变更导致的风险,新老应用兼容等

### 如何实现路由策略？

通过服务发现的方式来隔离调用方请求,实现灰度

缺点:将计算逻辑放到注册中心中,增加注册中心压力;对注册中心需要二开

在调用方收到规则后，在选择具体要发请求的节点前，会先通过筛选规则过滤节点集合.然后可以利用该规则实现.

![image-20220110171925191](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220110171925191.png)

筛选过程被称为路由策略.

### 参数路由

需求:流量切换

所有的服务提供方节点都打上标签，用来区分新老应用节点。在服务调用方发生请求的时候，我们可以很容易地拿到请求参数，也就是我们例子中的商品 ID，我们可以根据注册中心下发的规则来判断当前商品 ID 的请求是过滤掉新应用还是老应用的节点。

相比 IP 路由，参数路由支持的灰度粒度更小，他为服务提供方应用提供了另外一个服务治理的手段。灰度发布功能是 RPC 路由功能的一个典型应用场景，通过 RPC 路由策略的组合使用可以让服务提供方更加灵活地管理、调用自己的流量，进一步降低上线可能导致的风险。



参考:

[spring cloud gateway](https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories)

https://github.com/alibaba/Sentinel/wiki/Sentinel%E5%B7%A5%E4%BD%9C%E4%B8%BB%E6%B5%81%E7%A8%8B)