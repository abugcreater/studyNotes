# 17 | 跳表：为什么Redis一定要用跳表来实现有序集合？

### 如何理解“跳表”？

**跳表:链表加多级索引的结构. 新增索引后,减少了遍历节点个数,提高了查找效率**

![image-20211227221732543](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211227221732543.png)

### 用跳表查询到底有多快？

如果没2个节点抽一个作为索引,那么第一级就有n/2个,**第 k 级索引的结点个数是第 k-1 级索引的结点个数的 1/2，那第 k级索引结点的个数就是 n/(2k)。**

假设有h级索引,最高有两个节点,可以得到 n/(2h)=2，从而求得 h=log2n-1.跳表高度log2n,如果每一层都要遍历 m 个结点，那在跳表中查询一个数据的时间复杂度就是 O(m*logn)。

### 跳表是不是很浪费内存？

每一级索引节点相加,根据等比数列求和，跳表的空间复杂度是 O(n)。如果索引越稀疏,那么空间复杂度越小.

### 高效的动态插入和删除

跳表这个动态数据结构，不仅支持查找操作，还支持动态的插入、删除操作，而且插入、删除操作的时间复杂度也是 O(logn)。

![image-20211227223831853](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211227223831853.png)

### 跳表索引动态更新

如果链表中结点多了，索引结点就相应地增加一些，避免复杂度退化，以及查找、插入、删除操作性能下降。我们通过一个随机函数，来决定将这个结点插入到哪几级索引中，比如随机函数生成了值 K，那我们就将这个结点添加到第一级到第 K 级这 K 级索引中。

![image-20211227223930592](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211227223930592.png)

### 解答开篇

插入、删除、查找以及迭代输出有序序列这几个操作，红黑树也可以完成，时间复杂度跟跳表是一样的。但是，按照区间来查找数据这个操作，红黑树的效率没有跳表高。

对于按照区间查找数据这个操作，跳表可以做到 O(logn) 的时间复杂度定位区间的起点，然后在原始链表中顺序往后遍历就可以了。这样做非常高效。

[跳表的实现](https://github.com/wangzheng0822/algo)