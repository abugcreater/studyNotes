# 62 | 职责链模式：如何实现可灵活扩展算法的敏感信息过滤框架？
职责链模式(Chain Of Responsibility Design Pattern):将请求的发送和接收解耦，让多个接收对象都有机会处理这个请求。将这些接收对象串成一条链，并沿着这条链传递这个请求，直到链上的某个接收对象能够处理它为止。

实现: 基于链表实现职责链模式

```java
// 使用模版模式将重复代码写到父类中,定义接口,子类只需要实现接口即可
public abstract class Handler {
	protected Handler successor = null;
	public void setSuccessor(Handler successor) {
		this.successor = successor;
	}
	public final void handle() {
		boolean handled = doHandle();
		if (successor != null && !handled) {
		successor.handle();
	}
}
	protected abstract boolean doHandle();
}
//客户端调用
public class HandlerChain {
	private Handler head = null;
	private Handler tail = null;
	public void addHandler(Handler handler) {
		handler.setSuccessor(null);
		if (head == null) {
			head = handler;
			tail = handler;
		return;
		}
	tail.setSuccessor(handler);
	tail = handler;
}
	public void handle() {
		if (head != null) {
			head.handle();
		}
	}
}

// 使用举例
public class Application {
	public static void main(String[] args) {
		HandlerChain chain = new HandlerChain();
		chain.addHandler(new HandlerA());
		chain.addHandler(new HandlerB());
		chain.handle();
	}
}
```

基于数组实现职责链模式

```Java
public interface IHandler {
	boolean handle();
}

public class HandlerChain {
	private List<IHandler> handlers = new ArrayList<>();

    public void addHandler(IHandler handler) {
        this.handlers.add(handler);
    }

    public void handle() {
        for (IHandler handler : handlers) {
            boolean handled = handler.handle();
            if (handled) {
                break;
            }
        }
    }
}
```

职责链模式的变种,所有链路上的处理器都处理一遍,应用场景如论坛的敏感词过滤,基于各个维度进行过滤.





框架中常用的过滤器和拦截器实现

`Spring Interceptor`和`Servlet Filter`不同之处在于，`Servlet Filter` 是 `Servlet` 规范的一部分，实现依赖于 Web 容器。`Spring Interceptor` 是 `Spring MVC` 框架的一部分，由` Spring MVC` 框架来提供实现。客户端发送的请求，会先经过 `Servlet Filter`，然后再经过` Spring Interceptor`，最后到达具体的业务代码中。

![image-20210830174214486](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210830174214486.png)



`Interceptor`实现类`HandlerExecutionChain`,`Filter`实现类`FilterChain`,Java只做了定义,具体内容由各个web容器自定义实现.



